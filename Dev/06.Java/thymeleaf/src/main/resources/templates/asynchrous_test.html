<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fetch API Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .lab-section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section-title {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .result-box {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 5px;
            padding: 20px;
            margin: 15px 0;
            min-height: 100px;
        }

        .result-title {
            font-weight: bold;
            color: #4a5568;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Fetch API Test</h1>
            <p>REST APIì™€ í†µì‹ </p>
        </div>

        <!--JSON ë°ì´í„° ë°›ê¸°-->
        <div class="lab-section">
            <h2 class="section-title">
               JSON ë°ì´í„° ë°›ê¸°
            </h2>

            <div class="alert alert-info">
                ì„œë²„ì—ì„œ JSON í˜•ì‹ì˜ ë°ì´í„°ë¥¼ ë°›ì•„ì™€ í™”ë©´ì— í‘œì‹œí•©ë‹ˆë‹¤.
            </div>

            <button class="btn btn-success" onclick="fetchInfo()">
                GET /api/info ì‹¤í–‰
            </button>

            <div class="result-box">
                <div class="result-title">JSON ì‘ë‹µ:</div>
                <div id="info-result">
                    ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ JSON ë°ì´í„°ê°€ í‘œì‹œë©ë‹ˆë‹¤.
                </div>
            </div>
        </div>

        <!--ë©”ì‹œì§€ ëª©ë¡ ì¡°íšŒ (ë°°ì—´ ë°ì´í„°)-->
        <div class="lab-section">
            <h2 class="section-title">
                ë©”ì‹œì§€ ëª©ë¡ ì¡°íšŒ (ë°°ì—´ ë°ì´í„°)
            </h2>

            <div class="alert alert-info">
                ì„œë²„ì—ì„œ ë°°ì—´ í˜•íƒœì˜ ë°ì´í„°ë¥¼ ë°›ì•„ì™€ í™”ë©´ì— ë¦¬ìŠ¤íŠ¸ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.
            </div>

            <!--ì—¬ëŸ¬ ë²„íŠ¼ ê·¸ë£¹ìœ¼ë¡œ ë¬¶ê¸°-->
            <div class="btn-group">
                <!--ëª¨ë“  ë©”ì‹œì§€ ì¡°íšŒ-->
                <button class="btn btn-info" onclick="fetchServerStatus()">
                    ì„œë²„ ìƒíƒœ í™•ì¸
                </button>

                <!--ëª¨ë“  ë©”ì‹œì§€ ì¡°íšŒ-->
                <button class="btn btn-info" onclick="fetchMessages()">
                    ëª¨ë“  ë©”ì‹œì§€ ì¡°íšŒ
                </button>

                <!--íŠ¹ì • IDì˜ ë©”ì‹œì§€ ì¡°íšŒ (íŒŒë¼ë¯¸í„° ì „ë‹¬)-->
                <button class="btn btn-info" onclick="fetchMessageById(1)">
                    ID=1 ë©”ì‹œì§€ ì¡°íšŒ
                </button>

                <!--íŠ¹ì • IDì˜ ë©”ì‹œì§€ ì¡°íšŒ (íŒŒë¼ë¯¸í„° ì „ë‹¬)-->
                <button class="btn btn-info" onclick="fetchMessageById(2)">
                    ID=2 ë©”ì‹œì§€ ì¡°íšŒ
                </button>

                <!--íŠ¹ì • IDì˜ ë©”ì‹œì§€ ì¡°íšŒ (íŒŒë¼ë¯¸í„° ì „ë‹¬)-->
                <button class="btn btn-info" onclick="fetchMessageById(3)">
                    ID=3 ë©”ì‹œì§€ ì¡°íšŒ
                </button>

                <!--íŠ¹ì • IDì˜ ë©”ì‹œì§€ ì¡°íšŒ (íŒŒë¼ë¯¸í„° ì „ë‹¬)-->
                <button class="btn btn-info" onclick="fetchMessageById(999)">
                    ID=999 ë©”ì‹œì§€ ì¡°íšŒ
                </button>
            </div>

            <div class="result-box">
                <div class="result-title">ë©”ì‹œì§€ ëª©ë¡:</div>
                <div id="messages-result">
                    ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ë©”ì‹œì§€ ëª©ë¡ì´ í‘œì‹œë©ë‹ˆë‹¤.
                </div>
            </div>

        </div>


    </div>

<script>
    // JSON ë°ì´í„° ë°›ê¸°
        function fetchInfo() {
            const resultDiv = document.getElementById('info-result');
            resultDiv.innerHTML = "Loading...";

            fetch('/api/info')
                .then(response => response.json())
                .then(data => {
                    console.log('JSON ë°ì´í„°: ', data);
                    resultDiv.innerHTML = JSON.stringify(data, null, 2);
                })
                .catch(error => {
                    resultDiv.innerHTML = `Error:${error.message} `;
                })
        }

        function fetchServerStatus() {
            const resultDiv = document.getElementById('messages-result');

            fetch("/api/status")
                .then(response => response.json())

                .then(status => {
                    const date = new Date(status.timestamp);

                    resultDiv.innerHTML = `
                        <div style="padding: 20px; background: #e6fffa; border-radius: 10px;">
                            <h3>ì„œë²„ ìƒíƒœ</h3>
                            <p>ìƒíƒœ ${status.server}</p>
                            <p>ë©”ì‹œì§€ ê°œìˆ˜: ${status.messageCount}</p>
                            <p>í™•ì¸ ì‹œê°„: ${date.toLocaleString()}</p>
                        </div>
                    `;
                })
        }

        function fetchMessages() {
            const resultDiv = document.getElementById('messages-result');

            resultDiv.innerHTML = '<div class=""></div>ë©”ì‹œì§€ ë¡œë”© ì¤‘...'

            fetch('/api/messages')
                .then(response => response.json())  //ë°°ì—´ë„ json()ìœ¼ë¡œ íŒŒì‹±
                .then(messages => { // [{...}, {...}, {...}]
                    console.log('ë©”ì‹œì§€ ëª©ë¡: ', messages);

                    if(messages.length == 0) {
                        resultDiv.innerHTML = 'ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.';
                        return;     //í•¨ìˆ˜ ì¢…ë£Œ
                    }

                    let html = '<div style="display: grid; gap: 10px;">';
                    // forEach : ë°°ì—´ì˜ ê° ìš”ì†Œì— ëŒ€í•´ í•¨ìˆ˜ ì‹¤í–‰
                    messages.forEach(msg => {
                        html += `
                            <div style="padding: 15px; background: #fff;
                                border-left: 3px solid #667eea;
                                border-radius: 5px;">
                                <strong>${msg.title}</strong><br>
                                <small style="color: #666;">
                                    ì‘ì„±ì: ${msg.author} | ID: ${msg.id}
                                </small><br>
                                <p style="margin-top: 10px;">${msg.content}</p>
                            </div>
                        `;
                    })
                    html += '</div>';

                    // ìƒì„±ëœ HTMLì„ DOMì— ì‚½ì…
                    resultDiv.innerHTML = html;
                })
                .catch(error => {
                    resultDiv.innerHTML = `âŒ ì—ëŸ¬: ${error.message}`;
                })
        }

        // íŠ¹ì • ë©”ì‹œì§€ ì¡°íšŒ (PathVariable)
        function fetchMessageById(id) {
            const resultDiv = document.getElementById('messages-result');

            //idê°€ 1ì´ë©´ => '/api/messages/1'
            fetch(`/api/messages/${id}`)
                .then(response => {
                    // HTTP ìƒíƒœ ì½”ë“œ ì²´í¬
                    // response.ok: ìƒíƒœì½”ë“œê°€ 200-299ë©´ true
                    if(!response.ok) {
                        // 404 ì—ëŸ¬ ì²˜ë¦¬
                        if (response.status == 404) {
                            throw new Error('ë©”ì‹œì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                        }
                        // ê¸°íƒ€ HTTP ì—ëŸ¬
                        throw new Error('HTTP error! status: ${response.status}')
                    }
                    return response.json();     // ì •ìƒ ì‘ë‹µì´ë©´ JSON íŒŒì‹±
                 })
                .then(message => {
                    // ë‹¨ì¼ ë©”ì‹œì§€ í‘œì‹œ
                    resultDiv.innerHTML = `
                        <div style="padding: 20px; background: #f0f4f8;
                                    border-radius: 10px;">
                            <h3>${message.title}</h3>
                            <p>${message.content}</p>
                            <small>ì‘ì„±ì: ${message.author}</small>
                        </div>
                    `;
                 })

                .catch(error => {
                    //ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
                    resultDiv.innerHTML = `ğŸš§ ${error.message}`;
                })

        }


</script>
</body>
</html>


















